<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø­Ø§Ø³Ø¨Ø© hlwany1s â€“ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¥Ø¯Ù…Ù† (Ù…Ø±Ø¨ÙˆØ·Ø©)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:'Segoe UI',system-ui,Tahoma,Arial;background:#00332d;color:#fff;margin:0;padding:0;text-align:center;animation:fadeIn 1.2s ease-in-out}
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    header img{width:80px;margin-top:15px}
    h1{font-size:26px;margin-bottom:10px;color:#19f6a7}
    .container{background:#00463f;margin:20px auto;padding:20px;border-radius:10px;width:90%;max-width:720px;box-shadow:0 0 20px #012f2a}
    input,select,textarea{width:90%;padding:10px;margin-top:10px;border:none;border-radius:7px;font-size:16px;background:#072f2a;color:#fff}
    button{margin-top:15px;padding:10px 16px;background:#19f6a7;color:#00332d;font-weight:700;border:none;border-radius:8px;cursor:pointer;transition:.25s}
    button:hover{background:#11c98a}
    .btn-danger{background:#e74c3c;color:#fff}
    .btn-danger:hover{background:#c0392b}
    #result1,#result2{margin-top:12px;font-size:18px;color:#ffd700}
    .muted{color:#d2e5df;font-size:13px;opacity:.95}
    .row{display:grid;gap:10px;grid-template-columns:1fr 1fr;max-width:720px;margin:0 auto}
    .row-3{grid-template-columns:1fr 1fr 1fr}
    .pill{display:inline-block;border:1px solid #0b4f46;border-radius:999px;padding:6px 10px;background:#073d36;color:#aeead7;margin-bottom:6px}
    .social{margin:20px auto 28px}
    .icons{display:flex;justify-content:center;gap:15px;flex-wrap:wrap}
    .icons a img{width:28px;height:28px;transition:.25s}
    .icons a:hover img{transform:scale(1.2)}
    footer img{width:100px;margin:24px auto 30px;opacity:.9}
    .details{font-size:13px;color:#cfe7e2;margin-top:6px}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{border-bottom:1px solid #0b4f46;padding:8px;text-align:center}
    th{color:#aeead7}
    .summary{display:grid;grid-template-columns:1fr;gap:10px;max-width:720px;margin:0 auto}
    .kpi{background:#073d36;border:1px solid #0b4f46;border-radius:10px;padding:10px}
    .kpi .val{font-size:20px;color:#ffd700;margin-top:6px}
    tr.deleted{opacity:.45;text-decoration:line-through;color:#999}
    td.actions button{padding:6px 8px;border-radius:6px}
  </style>
</head>
<body>
  <header>
    <img src="hlwany_logo_final.png" alt="Logo">
    <h1>Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù€ <strong>hlwany1s</strong></h1>
    <div class="pill" id="now">--:--</div>
  </header>

  <div class="container">
    <h3>ğŸ’° Ø§Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ù…Ù† Ø§Ù„Ù…Ø¨Ù„Øº</h3>
    <p class="muted">Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¬Ù†ÙŠÙ‡ Ø§Ù„Ù…ØµØ±ÙŠ</p>
    <input id="money" type="number" inputmode="numeric" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¬Ù†ÙŠÙ‡" />
    <div class="row">
      <button id="btnMoney">Ø§Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Øª ğŸ§®</button>
      <button id="btnClear1" type="button">Ù…Ø³Ø­</button>
    </div>
    <div id="result1"></div>
    <div id="details1" class="details"></div>
  </div>

  <div class="container">
    <h3>ğŸª™ Ø§Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø± Ù…Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Øª</h3>
    <p class="muted">Ø§ÙƒØªØ¨ Ø¹Ø¯Ø¯ Ø¹Ù…Ù„Ø§Øª ØªÙŠÙƒ ØªÙˆÙƒ</p>
    <input id="coins" type="number" inputmode="numeric" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Øª" />
    <div class="row">
      <button id="btnCoins">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø± ğŸ’µ</button>
      <button id="btnClear2" type="button">Ù…Ø³Ø­</button>
    </div>
    <div id="result2"></div>
    <div id="details2" class="details"></div>
  </div>

  <!-- Ù‚Ø³Ù… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (ÙˆØ§Ø¬Ù‡Ø© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ù€ Web App) -->
  <div class="container">
    <h3>â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© (ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°)</h3>
    <p class="muted">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¯Ù…Ù†ØŒ Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)ØŒ ÙˆØ§Ø¶ØºØ· Ø¥Ø¶Ø§ÙØ©. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³ØªØ±Ø³Ù„ Ù„Ù„Ø´ÙŠØª ÙˆØ¹Ù†Ø¯ ÙØ´Ù„ ØªÙØ®Ø²Ù† ÙˆØªÙØ¹Ø§Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</p>

    <div class="row">
      <select id="adminSelect">
        <option value="A">A</option>
        <option value="T">T</option>
        <option value="MS">MS</option>
        <option value="MO">MO</option>
        <option value="E">E</option>
      </select>
      <input id="note" type="text" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" />
    </div>

    <div class="row">
      <button id="btnAdd">Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© (ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°)</button>
      <button id="btnClearAll" type="button">Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
    </div>

    <div id="sendStatus" class="muted" style="margin-top:8px"></div>

    <!-- Ù…Ù„Ø®Øµ: Ù†Ø¹Ø±Ø¶ ÙÙ‚Ø· Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª -->
    <div class="summary" style="margin-top:12px">
      <div class="kpi"><div>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div><div id="kpiOps" class="val">0</div></div>
    </div>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø¢Ø®Ø± 10 Ø¹Ù…Ù„ÙŠØ§Øª ÙÙ‚Ø· -->
    <table id="logTable">
      <thead>
        <tr>
          <th>#</th>
          <th>Ø§Ù„ÙˆÙ‚Øª</th>
          <th>Ø§Ù„Ø£Ø¯Ù…Ù†</th>
          <th>Ø§Ù„ÙÙ„ÙˆØ³ (EGP)</th>
          <th>Ø§Ù„Ø¹Ù…Ù„Ø§Øª</th>
          <th>Ø§Ù„ÙˆØ¶Ø¹</th>
          <th>Ù…Ù„Ø§Ø­Ø¸Ø©</th>
          <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <p class="muted">ÙŠØªÙ… Ø¹Ø±Ø¶ Ø¢Ø®Ø± <strong>10</strong> Ø¹Ù…Ù„ÙŠØ§Øª ÙÙ‚Ø· Ù‡Ù†Ø§ (Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ø­ÙÙˆØ¸ Ø¯Ø§Ø®Ù„ÙŠÙ‹Ø§).</p>
  </div>

  <div class="social">
    <p>Ù„Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§:</p>
    <div class="icons">
      <a href="https://t.me/hlwany_Store" target="_blank" rel="noopener noreferrer"><img src="https://img.icons8.com/color/48/telegram-app--v1.png" alt="Telegram"></a>
      <a href="https://wa.me/201050010931" target="_blank" rel="noopener noreferrer"><img src="https://img.icons8.com/color/48/whatsapp--v1.png" alt="WhatsApp"></a>
      <a href="https://www.instagram.com/hlwany1s" target="_blank" rel="noopener noreferrer"><img src="https://img.icons8.com/color/48/instagram-new--v1.png" alt="Instagram"></a>
      <a href="https://www.facebook.com/share/16br88wt3K/?mibextid=wwXIfr" target="_blank" rel="noopener noreferrer"><img src="https://img.icons8.com/color/48/facebook-new.png" alt="Facebook"></a>
      <a href="https://www.tiktok.com/@hlwany1s" target="_blank" rel="noopener noreferrer"><img src="https://img.icons8.com/color/48/tiktok--v1.png" alt="TikTok"></a>
    </div>
  </div>

  <footer>
    <img src="hlwany_logo_final.png" alt="Logo">
  </footer>

  <script>
    // === Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª â€” ØºÙŠÙ‘Ø± Ù„Ùˆ Ø§Ø­ØªØ¬Øª Ù„Ø§Ø­Ù‚Ù‹Ø§ ===
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzW34HY3yZEy7athLmtepQBOCbP2Z08CkubprkWEzXc24MoJAcl_of8C2G8DUS1h1gykQ/exec';
    const SHARED_TOKEN = 'a9f3b2e1-5c6d-4f7a-9b8c-1234567890ab';

    // Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
    const STORAGE_KEY = 'hlwany_session_log_v1';
    const QUEUE_KEY = 'hlwany_send_queue_v1';

    // ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
    const prices = {
      75:50,115:70,160:100,220:135,300:175,330:190,355:205,
      520:300,715:410,890:500,1000:550,1500:825,1820:1000,
      2000:1100,2500:1375,3000:1650,3500:1925,4000:2225,
      4500:2475,5000:2740,5500:3015,6000:3290,6500:3560,
      7000:3835,8000:4375,9000:4915,10000:5450,12000:6540,
      13000:7085,14000:7630,17500:9540,20000:10900,25000:13600,
      30000:16330,36850:20000,50000:27100,75000:40600,100000:54000
    };

    // ØªÙ‡ÙŠØ¦Ø©
    const coinList = Object.keys(prices).map(c=>+c).sort((a,b)=>a-b);
    const priceList = coinList.map(c=>({coins:c,price:prices[c]})).sort((a,b)=>a.price-b.price);
    const fmt = n => new Intl.NumberFormat('ar-EG').format(Math.round(n));

    // Ø­Ø³Ø§Ø¨Ø§Øª
    function computeMoneyFromCoins(coins){
      if(!coins||coins<0) return {amount:0,note:''};
      if(prices[coins]) return {amount:prices[coins],note:'ØªØ·Ø§Ø¨Ù‚ Ø´Ø±ÙŠØ­Ø© Ù…Ø¨Ø§Ø´Ø±Ø©'};
      let lower=null,upper=null;for(let i=0;i<coinList.length;i++){if(coinList[i]<coins)lower=coinList[i];if(coinList[i]>coins){upper=coinList[i];break;}}
      if(lower&&upper){const lp=prices[lower],up=prices[upper];const prop=(coins-lower)/(upper-lower);const est=Math.round(lp+prop*(up-lp));return {amount:est,note:`ØªÙ‚Ø±ÙŠØ¨ Ø¨ÙŠÙ† ${lower}â†’${fmt(lp)} Ùˆ ${upper}â†’${fmt(up)}`};}
      else if(!lower){const c1=coinList[0],c2=coinList[1],p1=prices[c1],p2=prices[c2];const slope=(p2-p1)/(c2-c1);const est=Math.max(1,Math.round(p1+(coins-c1)*slope));return {amount:est,note:`Ø§Ø³ØªÙ‚Ø±Ø§Ø¡ Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ (Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ${c1} Ùˆ ${c2})`};}
      else{const c1=coinList[coinList.length-2],c2=coinList[coinList.length-1],p1=prices[c1],p2=prices[c2];const slope=(p2-p1)/(c2-c1);const est=Math.round(p2+(coins-c2)*slope);return {amount:est,note:`Ø§Ø³ØªÙ‚Ø±Ø§Ø¡ Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ (Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ${c1} Ùˆ ${c2})`};}
    }

    function computeCoinsFromMoney(money){
      if(!money||money<0) return {coins:0,note:''};
      const exact = priceList.find(x=>x.price===money);
      if(exact) return {coins:exact.coins,note:'ØªØ·Ø§Ø¨Ù‚ Ø´Ø±ÙŠØ­Ø© Ù…Ø¨Ø§Ø´Ø±Ø©'};
      let lower=null,upper=null;for(let i=0;i<priceList.length;i++){if(priceList[i].price<=money)lower=priceList[i];if(priceList[i].price>money){upper=priceList[i];break;}}
      if(lower&&upper){const prop=(money-lower.price)/(upper.price-lower.price);const est=Math.round(lower.coins+prop*(upper.coins-lower.coins));return {coins:est,note:`ØªÙ‚Ø±ÙŠØ¨ Ø¨ÙŠÙ† ${fmt(lower.price)}â†’${lower.coins} Ùˆ ${fmt(upper.price)}â†’${upper.coins}`};}
      else if(!lower){const a=priceList[0],b=priceList[1];const slope=(b.coins-a.coins)/(b.price-a.price);const est=Math.max(0,Math.round(a.coins+(money-a.price)*slope));return {coins:est,note:`Ø§Ø³ØªÙ‚Ø±Ø§Ø¡ Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ (Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ${fmt(a.price)} Ùˆ ${fmt(b.price)})`};}
      else{const a=priceList[priceList.length-2],b=priceList[priceList.length-1];const slope=(b.coins-a.coins)/(b.price-a.price);const est=Math.round(b.coins+(money-b.price)*slope);return {coins:est,note:`Ø§Ø³ØªÙ‚Ø±Ø§Ø¡ Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ (Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ${fmt(a.price)} Ùˆ ${fmt(b.price)})`};}
    }

    // Ø¹Ø±Ø¶
    function fromCoins(){const coins=+document.getElementById('coins').value;const out=document.getElementById('result2');const det=document.getElementById('details2');const r=computeMoneyFromCoins(coins);out.textContent=r.amount? `Ø§Ù„Ø³Ø¹Ø±: ${fmt(r.amount)} Ø¬Ù†ÙŠÙ‡` : '';det.textContent=r.note;lastCalc='coins';}
    function fromMoney(){const money=+document.getElementById('money').value;const out=document.getElementById('result1');const det=document.getElementById('details1');const r=computeCoinsFromMoney(money);out.textContent=r.coins? `ÙŠÙ…ÙƒÙ†Ùƒ Ø´Ø±Ø§Ø¡: ${fmt(r.coins)} Ø¹Ù…Ù„Ø©` : '';det.textContent=r.note;lastCalc='money';}

    // Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­ÙŠ
    const nowEl=document.getElementById('now');
    setInterval(()=>{const d=new Date(),p=n=>String(n).padStart(2,'0');nowEl.textContent=`${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())} ${p(d.getHours())}:${p(d.getMinutes())}:${p(d.getSeconds())}`;},1000);

    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ù„ÙŠ
    function loadLog(){try{const raw=localStorage.getItem(STORAGE_KEY);return raw?JSON.parse(raw):[]}catch(e){return[]}}
    function saveLog(list){localStorage.setItem(STORAGE_KEY,JSON.stringify(list))}

    function addEntry(row){const list=loadLog();list.push(row);saveLog(list);renderTable();renderKpis();}

    function renderKpis(){const list=loadLog();document.getElementById('kpiOps').textContent=fmt(list.length);} 

    function renderTable(){const list=loadLog();const tbody=document.querySelector('#logTable tbody');tbody.innerHTML='';const lastTen=list.slice(-10);const baseIndex=list.length-lastTen.length;lastTen.forEach((r,i)=>{const trueIndex=baseIndex+i;const tr=document.createElement('tr');if(r.deleted) tr.classList.add('deleted');tr.innerHTML=`<td>${trueIndex+1}</td>
          <td>${r.timestamp}</td>
          <td>${r.admin}</td>
          <td>${fmt(r.amountEGP)}</td>
          <td>${fmt(r.coins)}</td>
          <td>${r.mode==='money_to_coins'?'ÙÙ„ÙˆØ³â†’Ø¹Ù…Ù„Ø§Øª':'Ø¹Ù…Ù„Ø§Øªâ†’ÙÙ„ÙˆØ³'}</td>
          <td>${r.note||''}</td>
          <td class="actions">${r.deleted? '<span class="muted">ØªÙ… Ø§Ù„Ø­Ø°Ù</span>' : `<button class="btn-danger btn-del" data-index="${trueIndex}">Ø­Ø°Ù</button>`}</td>`;tbody.appendChild(tr);});}

    // Ø­Ø°Ù Ù…Ø­Ù„ÙŠ (ÙŠØ¶Ø¹ ÙˆØ³Ù… deleted Ø£Ùˆ ÙŠØ­Ø°Ù)
    document.getElementById('logTable').addEventListener('click',(e)=>{const btn=e.target.closest('.btn-del');if(!btn) return;const idx=+btn.getAttribute('data-index');const list=loadLog();if(idx>=0 && idx<list.length){if(confirm('Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ©ØŸ')){list[idx].deleted=true;saveLog(list);renderTable();renderKpis();}}});

    // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù€ Apps Script
    async function sendPayload(payload){try{const res=await fetch(WEB_APP_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({...payload,token:SHARED_TOKEN}),cache:'no-store'});const text=await res.text();try{return JSON.parse(text)}catch(e){return {status:'error',message:text||'no-response'}}}catch(err){return {status:'error',message:String(err)}}}

    function pushToQueue(payload){const q=JSON.parse(localStorage.getItem(QUEUE_KEY)||'[]');q.push(payload);localStorage.setItem(QUEUE_KEY,JSON.stringify(q));}

    async function processQueue(){const q=JSON.parse(localStorage.getItem(QUEUE_KEY)||'[]');if(!q.length) return;const remaining=[];for(const item of q){const r=await sendPayload(item);if(r && r.status==='ok'){console.log('Queue item sent OK',item);}else{console.warn('Queue item failed, will retry',r,item);remaining.push(item);}}localStorage.setItem(QUEUE_KEY,JSON.stringify(remaining));}

    setInterval(processQueue,20000);window.addEventListener('load',processQueue);

    // Ø±Ø¨Ø· Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
    let lastCalc=null;
    document.getElementById('btnMoney').addEventListener('click',fromMoney);
    document.getElementById('btnCoins').addEventListener('click',fromCoins);

    document.getElementById('btnAdd').addEventListener('click',async ()=>{
      const sendStatus=document.getElementById('sendStatus');
      const admin=document.getElementById('adminSelect').value;
      const note=document.getElementById('note').value.trim();

      let mode='', amount=0, coins=0;
      if(lastCalc==='money'){const moneyVal=+document.getElementById('money').value||0;const rc=computeCoinsFromMoney(moneyVal);amount=moneyVal;coins=rc.coins;mode='money_to_coins';}
      else if(lastCalc==='coins'){const coinVal=+document.getElementById('coins').value||0;const ra=computeMoneyFromCoins(coinVal);amount=ra.amount;coins=coinVal;mode='coins_to_money';}
      else{const moneyVal=+document.getElementById('money').value||0;const coinVal=+document.getElementById('coins').value||0;if(coinVal && !moneyVal){const ra=computeMoneyFromCoins(coinVal);amount=ra.amount;coins=coinVal;mode='coins_to_money';}else{const rc=computeCoinsFromMoney(moneyVal);amount=moneyVal;coins=rc.coins;mode='money_to_coins';}}

      if(!amount || !coins){sendStatus.textContent='Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ (ÙÙ„ÙˆØ³â†’Ø¹Ù…Ù„Ø§Øª Ø£Ùˆ Ø¹Ù…Ù„Ø§Øªâ†’ÙÙ„ÙˆØ³) Ø«Ù… Ø£Ø¶Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.';return;}

      const d=new Date(),pad=n=>String(n).padStart(2,'0');const stamp=`${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;

      // Ø£Ø¶Ù Ù„Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ù„ÙŠ ÙÙˆØ±Ù‹Ø§
      addEntry({timestamp:stamp,admin,amountEGP:Math.round(amount),coins:Math.round(coins),mode,note});

      // Ø­Ø§ÙˆÙ„ ØªØ±Ø³Ù„Ù‡Ø§ Ù„Ù„Ø´ÙŠØª
      const payload={admin,mode,amountEGP:Math.round(amount),coins:Math.round(coins),note,timestamp:stamp};
      const res=await sendPayload(payload);
      if(res && res.status==='ok'){sendStatus.textContent='ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù„Ù„Ø´ÙŠØª âœ…';}
      else{pushToQueue(payload);sendStatus.textContent='ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ â€” Ø®Ø²Ù‘Ù† Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙˆØ³ÙŠØ¹Ø§Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§';}
    });

    // Ø£Ø²Ø±Ø§Ø± Ù…Ø³Ø§Ø¹Ø¯Ø©
    const moneyEl=document.getElementById('money');
    const coinsEl=document.getElementById('coins');
    document.getElementById('btnClear1').addEventListener('click',()=>{moneyEl.value='';document.getElementById('result1').textContent='';document.getElementById('details1').textContent='';moneyEl.focus();});
    document.getElementById('btnClear2').addEventListener('click',()=>{coinsEl.value='';document.getElementById('result2').textContent='';document.getElementById('details2').textContent='';coinsEl.focus();});
    document.getElementById('btnClearAll').addEventListener('click',()=>{localStorage.removeItem(STORAGE_KEY);moneyEl.value='';coinsEl.value='';document.getElementById('result1').textContent='';document.getElementById('details1').textContent='';document.getElementById('result2').textContent='';document.getElementById('details2').textContent='';renderTable();renderKpis();});
    moneyEl.addEventListener('keydown',e=>{if(e.key==='Enter') fromMoney();});
    coinsEl.addEventListener('keydown',e=>{if(e.key==='Enter') fromCoins();});

    // Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø±Ø¶
    renderTable();renderKpis();
  </script>
</body>
</html>
